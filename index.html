<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sz√≥da</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@300;400&display=swap');

        :root {
            --dark-blue: #0f172a; --mid-blue: #1e293b; --light-blue-text: #e0f7fa;
            --neon-cyan: #00bfff; --neon-green: #4ade80; --neon-amber: #f59e0b;
            --neon-purple: #c084fc;
        }

        body {
            font-family: 'Roboto', sans-serif; background-color: var(--dark-blue);
            color: var(--light-blue-text); text-align: center; margin: 0; padding: 20px;
            -webkit-tap-highlight-color: transparent;
        }
        
        #main-content { opacity: 0; transition: opacity 1s ease-in; }

        #game-layout {
            display: flex;
            justify-content: center;
            align-items: stretch; 
            gap: 30px;
            max-width: 1400px;
            margin: auto;
        }
        #left-column, #right-column { width: 280px; display: flex; flex-direction: column; flex-shrink: 0; }
        #center-column { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; }
        
        #logo-container { position: relative; margin-bottom: 20px; }
        .logo-text { font-family: 'Orbitron', sans-serif; font-size: 5em; font-weight: bold; color: #ffffff; text-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan); }
        
        .static-bubble {
            position: absolute; border-radius: 50%; background: rgba(0, 191, 255, 0.2);
            box-shadow: inset 0 0 10px rgba(255,255,255,0.5); z-index: -1;
            animation: fizz 6s ease-in-out infinite;
        }
        
        .sb1 { width: 50px; height: 50px; top: -10px; left: -30px; animation-delay: 0s; }
        .sb2 { width: 30px; height: 30px; top: 60%; right: -40px; animation-delay: -1.5s; }
        .sb3 { width: 60px; height: 60px; bottom: -20px; right: 50px; animation-delay: -3s; }
        .sb4 { width: 20px; height: 20px; bottom: 0; left: 20px; animation-delay: -4.5s; }

        @keyframes fizz {
            0% { transform: translateY(0) scale(1); opacity: 0.7; }
            25% { transform: translateY(-5px) scale(1.05); opacity: 0.5; }
            50% { transform: translateY(0) scale(0.95); opacity: 0.9; }
            75% { transform: translateY(5px) scale(1); opacity: 0.6; }
            100% { transform: translateY(0) scale(1); opacity: 0.7; }
        }

        .panel {
            padding: 20px; background-color: rgba(15, 23, 42, 0.8);
            border-radius: 8px; border: 1px solid rgba(0, 191, 255, 0.3);
            display: flex; flex-direction: column; position: relative; width: 100%; box-sizing: border-box;
            flex-grow: 1;
        }
        .panel-inner { position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; }
        .panel::before, .panel::after, .panel-inner::before, .panel-inner::after {
            content: ''; position: absolute; width: 15px; height: 15px;
            border-color: var(--neon-cyan); border-style: solid; opacity: 0.7;
        }
        .panel::before { top: 8px; left: 8px; border-width: 2px 0 0 2px; }
        .panel::after { top: 8px; right: 8px; border-width: 2px 2px 0 0; }
        .panel-inner::before { bottom: 8px; left: 8px; border-width: 0 0 2px 2px; }
        .panel-inner::after { bottom: 8px; right: 8px; border-width: 0 2px 2px 0; }

        #word-list-container h3, #rewards-container h3 { font-family: 'Orbitron', sans-serif; margin-top: 0; color: var(--neon-cyan); text-shadow: 0 0 5px var(--neon-cyan); }
        #timer-container { min-height: 60px; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 10px; }
        #timer-display { font-family: 'Orbitron', sans-serif; font-size: 1.2em; color: var(--light-blue-text); text-shadow: 0 0 5px var(--neon-cyan); margin-bottom: 5px; }
        #timer-display.warmup-round { color: var(--neon-amber); }
        
        #new-board-btn { display: none; padding: 15px 30px; font-size: 1.2em; font-family: 'Orbitron', sans-serif; cursor: pointer; color: white; background: linear-gradient(45deg, var(--neon-green), #22c55e); border: none; border-radius: 5px; }

        #end-round-choices { display: none; gap: 10px; }
        .choice-btn { flex: 1; padding: 10px; font-family: 'Orbitron', sans-serif; font-size: 0.9em; border-radius: 5px; border: none; cursor: pointer; color: white; }
        #btn-cash-in { background: linear-gradient(45deg, var(--neon-green), #22c55e); }
        #btn-risk-it { background: linear-gradient(45deg, var(--neon-amber), #e18c41); }

        #words {
            list-style: none; padding: 0; margin: 0;
            flex-grow: 1;
            column-count: 2;
            column-gap: 20px;
        }
        #words li { 
            padding: 5px; 
            margin-bottom: 5px; 
            font-size: 1.1em; 
            border-radius: 5px; 
            transition: all 0.3s ease; 
            text-align: left;
            -webkit-column-break-inside: avoid;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        #words li.found { 
            background: rgba(74, 222, 128, 0.2); 
            color: #a7f3d0;
            text-decoration: line-through;
            text-decoration-thickness: 2px;
            font-style: italic;
        }
        #rewards-list, #piac-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
        #piac-list { display: none; }
        
        .panel-bottom-section { margin-top: auto; padding-top: 15px; }
        #solution-container { margin-bottom: 15px; }
        #megoldas-btn {
            display: none; padding: 10px 20px; font-size: 1.1em;
            font-family: 'Orbitron', sans-serif; cursor: pointer; color: white;
            background: linear-gradient(45deg, var(--neon-amber), #e18c41);
            border: none; border-radius: 5px; width: 100%;
        }
        #megoldas-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        #score-container { text-align: center; flex-shrink: 0; position: relative; }
        #score { font-size: 2.5em; color: var(--neon-amber); font-weight: bold; }

        #multiplier-display { 
            display: none; 
            position: absolute; top: 0; right: 0; 
            background-color: var(--neon-amber); color: var(--dark-blue); 
            font-family: 'Orbitron', sans-serif; font-weight: bold;
            padding: 2px 6px; border-radius: 4px; font-size: 0.8em;
        }
        
        #grid-container {
            display: grid; grid-template-columns: repeat(9, 60px);
            gap: 5px; padding: 10px; border-radius: 10px; border: 1px solid rgba(0, 191, 255, 0.5);
            touch-action: none;
        }
        .grid-cell {
            width: 60px; height: 60px; display: flex; justify-content: center; align-items: center;
            background-color: var(--mid-blue); color: var(--light-blue-text);
            cursor: pointer; font-size: 2.5em; font-weight: bold; text-transform: uppercase;
            user-select: none; border-radius: 5px; transition: all 0.2s ease;
            position: relative;
        }
        .grid-cell.hint-found { background-color: #0c4a6e; color: #7dd3fc; box-shadow: 0 0 15px var(--neon-cyan); cursor: not-allowed; }
        .grid-cell.selected { background-color: var(--neon-amber); color: var(--mid-blue); box-shadow: 0 0 15px var(--neon-amber); transform: scale(1.05); }
        
        .grid-cell.bonus-dp { background-color: #4a330c; color: var(--neon-amber); box-shadow: 0 0 15px var(--neon-amber); }
        .grid-cell.bonus-time { background-color: #0c4a2e; color: var(--neon-green); box-shadow: 0 0 15px var(--neon-green); }

        .hidden-bubble-icon {
            position: absolute;
            bottom: 3px;
            right: 3px;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, rgba(0, 191, 255, 0.4) 0%, rgba(0, 191, 255, 0.1) 70%);
            border-radius: 50%;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        #current-word-container { display: flex; align-items: center; justify-content: center; margin-top: 15px; height: 50px; gap: 15px;}
        #current-word-preview {
            font-size: 2em; color: var(--neon-amber); letter-spacing: 2px;
            font-family: 'Orbitron', sans-serif; text-transform: uppercase;
            flex-grow: 1; text-align: center;
        }
        #clear-selection-btn {
            display: none; padding: 8px 15px; font-size: 0.9em;
            font-family: 'Orbitron', sans-serif; cursor: pointer; color: var(--dark-blue);
            background: var(--neon-amber); border: none; border-radius: 5px;
        }

        .reward-item {
            background-color: var(--mid-blue); border: 1px solid #334155;
            padding: 15px; margin-bottom: 12px;
            border-radius: 5px; cursor: pointer; transition: all 0.2s; text-align: left;
        }
        .reward-item.disabled { opacity: 0.4; cursor: not-allowed; }
        .reward-item.affordable {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan), 0 0 5px var(--neon-cyan) inset;
        }
        .piac-item.affordable {
            border-color: var(--neon-purple);
            box-shadow: 0 0 15px var(--neon-purple), 0 0 5px var(--neon-purple) inset;
        }
        .reward-name { font-weight: bold; font-size: 1.1em; color: #93c5fd; }
        .reward-desc { font-size: 0.8em; margin: 5px 0; color: #94a3b8; }
        .reward-cost { font-weight: bold; color: var(--neon-amber); text-align: right; }
        .piac-cost { font-weight: bold; color: var(--neon-purple); text-align: right; }

        #copyright { font-size: 0.9em; color: #64748b; margin-top: -10px; margin-bottom: 20px; }

        #rules-container { max-width: 800px; margin: 40px auto 0 auto; text-align: left; }
        #rules-container h2 { font-family: 'Orbitron', sans-serif; color: var(--neon-cyan); text-align: center; }
        #rules-container ul { list-style: none; padding-left: 0; }
        #rules-container li { margin-bottom: 15px; padding-left: 25px; position: relative; }
        #rules-container li::before { content: '>'; position: absolute; left: 0; color: var(--neon-cyan); font-weight: bold; }

        #soda-hunt-container { border-top: 1px solid rgba(0, 191, 255, 0.3); margin-top: 15px; padding-top: 15px; }
        #soda-hunt-letters { display: flex; justify-content: space-around; font-family: 'Orbitron', sans-serif; font-size: 2em; }
        #soda-hunt-letters span { color: #475569; transition: all 0.3s ease-in-out; }
        #soda-hunt-letters span.collected { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); transform: scale(1.2); }
        #soda-hunt-claim-btn { display: none; width: 100%; margin-top: 10px; padding: 10px; font-family: 'Orbitron', sans-serif; font-size: 1.2em; background: linear-gradient(45deg, var(--neon-purple), #9333ea); color: white; border: none; border-radius: 5px; cursor: pointer; }
        #active-powerup-display { font-size: 0.8em; color: var(--neon-green); margin-top: 10px; height: 20px;}
        
        #soda-penz-display { text-align: center; padding: 10px; margin-bottom: 10px; border-bottom: 1px solid rgba(0, 191, 255, 0.3); }
        #soda-penz-balance { font-family: 'Orbitron', sans-serif; font-size: 1.8em; color: var(--neon-purple); text-shadow: 0 0 8px var(--neon-purple); }
        .shop-tabs { display: flex; border-bottom: 1px solid rgba(0, 191, 255, 0.3); margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; background: none; border: none; color: #64748b; font-family: 'Orbitron', sans-serif; cursor: pointer; transition: all 0.2s; }
        .tab-btn.active { color: var(--neon-cyan); background: rgba(0, 191, 255, 0.1); border-bottom: 2px solid var(--neon-cyan); }


        @media (max-width: 900px) {
            body { padding: 10px 5px; }
            #game-layout { flex-direction: column; align-items: center; gap: 25px; }
            #left-column, #right-column, #center-column { width: 100%; max-width: 480px; }
            #center-column { order: 1; }
            #left-column { order: 2; }
            #right-column { order: 3; }
            .logo-text { font-size: 3.5em; }
            #grid-container { width: 95vw; max-width: 480px; height: 95vw; max-height: 480px; grid-template-columns: repeat(9, 1fr); gap: 1.1vw; padding: 1.5vw; }
            .grid-cell { font-size: clamp(14px, 5.5vw, 30px); border-radius: 1vw; }
            #current-word-container { height: 40px; }
            #current-word-preview { font-size: 1.5em; }
            #words li { font-size: 1.1em; padding: 6px 8px;}
            #clear-selection-btn { display: block; }
            #words { column-count: 1; max-height: 25vh; overflow-y: auto; }
            #rewards-list, #piac-list { max-height: 25vh; }
        }
    </style>
</head>
<body>
    <div id="main-content">
        <div id="game-layout">
            <div id="left-column">
                <div id="word-list-container" class="panel">
                    <div class="panel-inner">
                        <div id="timer-container">
                            <div id="timer-display"></div>
                            <button id="new-board-btn">Kezd≈ëdj√∂n az √©les j√°t√©k!</button>
                            <div id="end-round-choices">
                                <button id="btn-cash-in" class="choice-btn">Bev√°ltom</button>
                                <button id="btn-risk-it" class="choice-btn">Kock√°ztatok!</button>
                            </div>
                        </div>
                        <h3>KERESEND≈ê SZAVAK</h3>
                        <ul id="words"></ul>
                        <div class="panel-bottom-section">
                            <div id="solution-container">
                                <button id="megoldas-btn">Megold√°s Felfed√©se</button>
                            </div>
                            <div id="score-container">
                                <h3>PONTOK</h3>
                                <div id="score">0</div>
                                <div id="multiplier-display">2x</div>
                            </div>
                            <div id="soda-hunt-container">
                                <h3>SZ√ìDA-VAD√ÅSZAT</h3>
                                <div id="soda-hunt-letters">
                                    <span data-letter="SZ">SZ</span>
                                    <span data-letter="√ì">√ì</span>
                                    <span data-letter="D">D</span>
                                    <span data-letter="A">A</span>
                                </div>
                                <div id="active-powerup-display"></div>
                                <button id="soda-hunt-claim-btn">BEV√ÅLT√ÅS</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="center-column">
                <div id="logo-container">
                    <div class="static-bubble sb1"></div><div class="static-bubble sb2"></div>
                    <div class="static-bubble sb3"></div><div class="static-bubble sb4"></div>
                    <div class="logo-text">Sz√≥da</div>
                </div>
                <div id="copyright">Copyright ¬© by: Robi</div>
                <div id="grid-container"></div>
                <div id="current-word-container">
                    <div id="current-word-preview"></div>
                    <button id="clear-selection-btn">T√∂rl√©s</button>
                </div>
            </div>
            <div id="right-column">
                <div id="rewards-container" class="panel">
                    <div class="panel-inner">
                        <div id="soda-penz-display">
                            <h3>SZ√ìDA-P√âNZ</h3>
                            <div id="soda-penz-balance">0</div>
                        </div>
                        <div class="shop-tabs">
                            <button id="tab-nyeremeny" class="tab-btn active">Nyerem√©nybolt</button>
                            <button id="tab-piac" class="tab-btn">Sz√≥da-Piac</button>
                        </div>
                        <div id="rewards-list"></div>
                        <div id="piac-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="rules-container" class="panel">
        <div class="panel-inner">
            <h2>J√°t√©kszab√°lyzat</h2>
            <ul>
                <li><strong>A C√©l:</strong> Tal√°ld meg az √∂sszes elrejtett sz√≥t a 9x9-es bet≈±r√°cson, miel≈ëtt lej√°r az id≈ë!</li>
                <li><strong>10 Perces K√∂r√∂k:</strong> A j√°t√©k 10 perces k√∂r√∂kben zajlik. Ha egy k√∂r k√∂zep√©n csatlakozol, egy t√©t n√©lk√ºli <strong>Bemeleg√≠t≈ë K√∂rt</strong> j√°tszhatsz a k√∂vetkez≈ë teljes k√∂r kezdet√©ig.</li>
                <li><strong>Sz√≥keres√©s:</strong> K√∂sd √∂ssze a szomsz√©dos bet≈±ket a szavak kirak√°s√°hoz. A keresend≈ë szavak v√≠zszintesen √©s f√ºgg≈ëlegesen kanyarognak.</li>
                <li><strong>Kock√°ztass vagy Gy≈±jts:</strong> A k√∂r v√©g√©n d√∂nthetsz: a pontjaidat biztons√°gban Sz√≥da-P√©nzre v√°ltod, vagy kock√°ztatsz egy 2x szorz√≥√©rt a k√∂vetkez≈ë k√∂rben. De vigy√°zz, ha a b√≥nusz k√∂rben nem tal√°lsz meg minden sz√≥t, a t√©tk√©nt vitt pontjaidat elvesz√≠ted!</li>
                <li><strong>B√≥nusz Mez≈ëk:</strong> A s√°rga (DP) mez≈ë megdupl√°zza a sz√≥√©rt kapott pontot, a z√∂ld (+15s) pedig 15 m√°sodpercet ad a h√°tral√©v≈ë id≈ëdh√∂z.</li>
                <li><strong>Sz√≥da-Vad√†szat:</strong> Gy≈±jtsd √∂ssze a t√°bl√°n elrejtett SZ-√ì-D-A bet≈±ket rejt≈ë bubor√©kokat! Ha mind megvan, bev√°lthatod ≈ëket egy 24 √≥r√°s szuperb√≥nuszra!</li>
                <li><strong>Nyerem√©nybolt & Sz√≥da-Piac:</strong> A pontjaidb√≥l k√∂r√∂n bel√ºli seg√≠ts√©get vehetsz (Nyerem√©nybolt), a Sz√≥da-P√©nzedb≈ël pedig maradand√≥ fejleszt√©seket √©s extra er≈ës b√≥nuszokat (Sz√≥da-Piac).</li>
            </ul>
        </div>
    </div>
    
    <script>
        const hungarianWords = [ 'ablak','abszurd','ac√©l','adat','adoma','adotts√°g','√°fonya','√°g','√°gy','agy','ajak','aj√°nd√©k','ajt√≥','akarat','akci√≥','akna','alag√∫t','alak','alakulat','alkalom','alkalmaz√°s','alkot√°s','alkotm√°ny','alku','√°ll','√°llam','√°llat','√°llom√°s','√°lom','√°men','am≈ëba','ampulla','amulett','anekdota','angyal','antenna','anya','anyag','apa','√°pol√≥','apr√≥','√°ram','arany','aranyos','arc','√°rok','√°rpa','√°rul√≥','√°s','√°sat√°s','√°tok','aut√≥','avar','azonos','b√°bu','bajnok','bakter','bal','baleset','balett','balta','b√°lv√°ny','b√°nat','banda','bank','b√°r','barack','b√°r√°ny','bar√°t','barlang','barna','b√°r√≥','b√°stya','b√°tor','b√°tr√°n','baz√°r','b√©bi','becs√ºlet','b√©ka','b√©ke','b√©lyeg','b√©r','berek','beteg','beton','bet≈±','bicikli','bika','bilincs','birtok','bit','bizalom','biztos','bl√∫z','bocs','bocs√°nat','bodza','b√≥ja','bokor','bolt','bolyg√≥','bomba','bor','borb√©ly','borda','b≈ër','bors','bot','boz√≥t','b√∂gre','b√∂lcs','b√∂lcs≈ë','b√∂rt√∂n','b≈ëven','b√∫cs√∫','bura','burgonya','b√∫tor','b√∫v√°r','b≈±v√©sz','b≈±z','c√°pa','c√°r','celeb','c√©l','cella','ceruza','cica','cig√°ny','cikk','cikornya','c√≠m','c√≠mer','cip≈ë','cirkusz','citrom','civil','comb','cudar','cukor','cumi','c√°folat','cs√°b','csal√°d','csap','csapat','csapda','csata','csavar','csel','csempe','csend','cseng≈ë','cser','csere','cser√©p','cs√©sze','csiga','cs√≠k','csillag','cs√≠p≈ë','csirke','csizma','csoda','cs√≥k','csomag','csom√≥','cs√≥nak','csont','csoport','cs≈ë','cs≈ër','cs√∫cs','cs√ºt√∂rt√∂k','dada','dal','dallam','d√°ma','dara','dar√°zs','d√°rda','d√°tum','december','defekt','dekolt√°zs','d√©l','delfin','delta','d√©mon','der√©k','dervis','design','deszka','detekt√≠v','deviza','diad√©m','di√°k','dics≈ës√©g','dikt√°tor','dilemma','dinamit','dinnye','di√≥','diploma','d√≠sz','diszn√≥','divat','dob','doboz','doh√°ny','doktor','dolog','domb','d√∂nt√©s','dosszi√©','d√≥zse','d≈ëzs','dr√°ma','dr√°ga','droid','duda','duma','d√ºh','dzsem','dzseki','dzsip','dzsungel','eb','eb√©d','ecet','√©den','ed√©ny','edz≈ë','√©g','eg√©r','eg√©sz','eg√©szs√©g','egyetem','egyh√°z','egy√ºtt','√©j','√©jf√©l','√©kszer','elme','√©lm√©ny','el≈ëny','ember','emelet','eml√©k','eml≈ës','√©nek','energia','epiz√≥d','epres','√©r','√©rc','√©rdem','erd≈ë','eredet','eredm√©ny','er√©ny','eresz','er≈ë','er≈ëd','er≈ës','√©rt√©k','√©rv','es√©ly','esk√º','es≈ë','este','√©sz','√©szak','eszme','eszperente','eszpressz√≥','√©tel','√©let','√©rem','√©v','ezer','ezredes','fagyi','fagy','faj','f√°jdalom','fal','falat','falu','far','farag','farok','farkas','farm','farmer','farsang','f√°tyol','fecske','fegyver','feh√©r','fej','fejfa','f√©k','fekete','feladat','felelet','felh≈ë','f√©l','f√©lelem','f√©m','fen√©k','feny≈ë','f√©rfi','f√©reg','fest√©k','f√©s≈±','f√©szek','fiask√≥','fiatal','fi√∫','film','filoz√≥fia','finom','fi√≥k','fizika','foci','fog','fogoly','fogy√°s','f√≥ka','fok','f√≥lia','folt','folyamat','foly√≥','folyos√≥','fon√°l','font','forgalom','forint','forma','forr√°s','forradalom','fotel','fot√≥','f≈ë','f≈ën√∂k','f√∂ld','f≈ë√∫t','f≈ëv√°ros','f≈ëzel√©k','f≈ëz√©s','friss','front','full√°nk','furcsa','f√∫r√≥','f√ºge','f√ºgg√∂ny','f≈±','f√ºrd≈ë','f≈±r√©sz','f√ºrj','f√ºst','f√ºzet','f≈±zfa','galamb','gall√©r','gar√°zs','gazda','g√°z','g√©m','g√©n','gep√°rd','g√©p','g√©sa','gesztus','gida','giliszta','gimn√°zium','gipsz','git√°r','gladi√°tor','gl√≥ria','g√≥b√©','g√≥l','goly√≥','gomb','gomba','gond','gondola','gong','g√∂mb','g√∂nd√∂r','g√∂ngy','g√∂rcs','g√∂r√©ny','g√∂r√∂g','g≈ëz','gr√°n√°t','gr√°nit','gr√≥f','g√∫la','gumi','g√∫ny','gyalog','gy√°m','gy√°r','gy√°sz','gy√©m√°nt','gyep','gyerek','gyertek','gyertya','gy√≠k','gyilkos','gy√≥gy√≠r','gy√∂k√©r','gy√∂ngy','gyors','gy≈ëzelem','gyufa','gy≈±r≈±','gy√ºm√∂lcs','ha','hab','had','hagyma','haj','hajnal','haj√≥','hal','hal√°l','h√°l√≥','halsz√°lka','hamis','hamu','hang','hang√°r','hangszer','hangya','harag','harang','harc','harisnya','h√°rfa','hasonl√≥','has','hat','hatalom','hat√°r','h√°t','hatty√∫','havas','h√°z','heged≈±','hegy','h√©j','hely','helyes','henger','herceg','hering','h√©t','h√©tf≈ë','h√©tv√©ge','hi√°ny','hiba','h√≠d','hideg','himnusz','hinta','h√≠r','hitel','hit','hivat√°s','h√≥','h√≥d','hold','holl√≥','hom√°r','homok','honlap','h√≥nap','hord√≥','horgony','horg√°sz','horoszk√≥p','hossz','hossz√∫','hotel','h√≥vir√°g','hulla','humor','hurka','h√∫s','h√∫sv√©t','huzat','h≈±','h≈±s√©g','idom√°r','id≈ë','iker','ikon','illat','ill√∫zi√≥','impala','impulzus','index','indig√≥','ind√≠t√©k','inf√≥','inger','ing','iroda','ir√≥nia','iskola','isten','iszap','ital','√≠t√©let','√≠z','izom','izz√≥','jacht','jagu√°r','jak','janu√°r','j√°rda','j√°spis','j√°t√©k','javas','j√°vorszarvas','j√©g','jel','jelens√©g','jellem','jelmez','jel√∂lt','jelv√©ny','jenki','jet','j√≥d','j√≥ga','joghurt','jog','joker','j√≥s','j√≥s√°g','j√∂v≈ë','j√∫lius','j√∫nius','juta','jutalom','kabal','kab√°t','kabin','kacaj','kacsa','k√°d','kakas','kaka√≥','kaktusz','kalap','kalauz','kal√≥z','k√°lyha','kamion','k√°mpa','kan√°l','kancell√°r','kand√∫r','k√°nikula','kanna','k√°osz','kapa','kapar√≥','kapcsol√≥','kapit√°ny','k√°polna','k√°poszta','kapu','kar','karabiner','karakter','kar√°m','kar√°t','karav√°n','kard','karnev√°l', 'k√°rtya','kast√©ly','katal√≥gus','katona','kauci√≥','k√°v√©','kaz√°n','kecske','kedd','kedves','kefe','k√©k','k√©m','k√©p','k√©rd√©s','ker√©k','kereszt','keret','kert','k√©s','keser≈±','k√©sz','kett≈ë','kever','k√©z','kincs','kir√°ly','kis','kocka','kocsi','k√≥d','k√∂d','k≈ë','k√∂lcs√∂n','k√∂lt≈ë','k√∂ly√∂k','k√∂m√©ny','k√∂nny','k√∂nyv','k√∂nny≈±','k√∂r','korm√°ny','korona','kors√≥','korz√≥','k√≥rh√°z','kos√°r','kosz','kota','kov√°cs','kotor','k√∂z','k√∂zeg','k√∂z√©p','k√∂z√∂s','kr√©ta','krimi','kripta','krist√°ly','kritika','krokodil','krumpli','k√∫t','kutya','kuvasz','k√ºld','k√ºls≈ë','k√ºrt','kv√≠z','l√°b','labor','l√°bsz√°r','l√°da','lak√°s','lakat','lakodalmas','l√°ng','lanka','lant','lap','lap√°t','lassan','l√°t','l√°tv√°ny','l√°va','l√°z','lecke','legenda','l√©gi√≥','l√©gszomj','l√©gy','lehel','l√©lek','lemez','lencse','lepke','l√©t','l√©tra','lev√©l','leves','lexikon','liba','lift','liga','lik≈ër','lila','limb√≥','limit','limon√°d√©','link','l√≠ra','lista','l√≥','lobog','logika','log√≥','lok√°l','lomb','lop','lott√≥','lovag','l√≥er≈ë','l≈ë','l√∂k','l√∂ncs','lucfeny≈ë','l√∫d','luk','lyuk','macska','mad√°r','mag','m√°gia','m√°gnes','magyar','m√°j','majom','makk','makr√©la','m√°lna','malom','m√°lyva','mandula','mank√≥','marad','maraton','marcip√°n','m√°rga','marha','m√°rka','m√°rv√°ny','m√°s','masina','masni','maszk','matematika','matrica','matr√≥z','med√°l','medence','meder','medve','m√©h','m√©ly','menedzser','menny','men√º','m√©r','mer√©nylet','mese','messze','mester','met√°l','metr√≥','m√©z','mez≈ë','miazma','mikrofon','mikul√°s','milli√°rd','milliomos','miniszter','minta','m√≠nusz','mirigy','mise','mitol√≥gia','m√≠tosz','miz√©ria','moha','m√≥ka','m√≥kus','molekula','m√≥l√≥','monitor','monokli','monoton','motor','mozi','muzsika','m≈±','m≈±faj','m≈±hely','m≈±sor','m≈±v√©sz','m≈±velet','n√°d','nadr√°g','nagy','naiv','nap','napl√≥','narancs','n√°rcisz','n√°sz','n√°tha','n√©gy','n√©gyzet','n√©p','n√©v','n√©z≈ë','nindzsa','n≈ë','n√≥ta','n≈ëv√©r','nug√°t','nulla','ny√°j','nyak','ny√°l','ny√°r','ny√°rs','nyelv','nyer','nyereg','nyers','nyest','ny√≠l','nyolc','nyom','nyugalom','nyugat','ny√∫l','ny√∫l√©kony','ny√ºsz√≠t','o√°zis','obeliszk','objekt√≠v','oboa','√≥c√©√°n','√≥da','od√∫','ok','okker','oklev√©l','okos','okt√≥ber','oktogon','olaj','olasz','oldal','oll√≥','√≥lom','olt√°r','olvas','ol√≠vabogy√≥','olyan','omlett','opera','opci√≥','optika','√≥ra','orb√°ncf≈±','orchidea','ordin√°ta','orgona','ork√°n','orom','orosz','orrszarv√∫','orvos','ostor','ostya','oszlop','oszt','oszt√°ly','otthon','√∂v','√∂z√∂n','≈ëz','pad','padl√°s','padlizs√°n','pajkos','pajzs','p√°k√≥','p√°lca','p√°lma','p√°lya','p√°nc√©l','pand√∫r','panel','p√°nik','panna','panor√°ma','pap','papag√°j','pap√≠r','paprika','papucs','paradicsom','parafa','parancs','par√°zs','park','p√°rna','p√°r','p√°rt','part','pasi','passz','paszta','pata','patak','p√°tens','patika','patk√°ny','p√°va','pazarl√°s','peca','pecs√©t','ped√°l','p√©k','pelik√°n','pemzli','p√©ntek','p√©nz','pepita','perec','per','peron','persze','pestis','pet√°rda','petrezselyem','pezsg≈ë','pia','piac','piccolo','pihen','pikkely','piktogram','pillanat','pille','pill√©r','pil√≥ta','pince','pingvin','pinty','pipa','piros','pisztoly','pite','pizsama','placc','plafon','plak√°t','plankton','pl√°za','pletyka','pl√ºss','p√≥','pog√°csa','poh√°r','p√≥ker','p√≥k','pokol','polc','polip','politika','pollen','p√≥l√≥','p√≥ni','pont','ponty','por','porcel√°n','porc','poros','porta','portr√©','posta','posz√°ta','potya','p√≥z','p√≥ker','p√∂rk√∂lt','p√∂tty','prizma','pr√≥ba','probl√©ma','professzor','program','projekt','pr√≥f√©ta','prolet√°r','prospektus','protein','protot√≠pus','p√∫der','puding','pulyka','pumpa','pult','p√∫p','puska','puszi','p√ºsp√∂k','rab','r√°cs','radar','rad√≠r','rag','ragu','ragyog','raj','rajz','r√°k','rak√©ta','ral','randi','rang','r√°nt√°s','r√°di√≥','reakci√≥','re√°l','recept','reccs','reggae','reggeli','rejt√©ly','rekl√°m','remek','rem√©ny','rend','rendszer','repce','repeta','r√©pa','repesz','rept√©r','r√©s','r√©sz','r√©t','retesz','retr√≥','reuma','revolver','rezg√©s','r√©z','riad√≥','ribizli','rig√≥','rikkancs','ring','riport','ritmus','ritu√°l√©','rizs','robot','robban','roham','rokkant','rokon','r√≥ka','rom','rom√°nc','rossz','rosta','rost','rovar','rozm√°r','rozs','r√∂gbi','r√∂plabda','r√∂vid','r≈ëzse','r√∫bel','rubin','r√∫d','ruha','r√∫na','r√∫zs','sajt','sakk','sak√°l','s√°l','salak','sal√°ta','s√°m√°n','sampion','s√°nc','s√°r','s√°rga','s√°rk√°ny','sarok','sas','s√°tor','sav','savany√∫','seb','seb√©sz','s√©f','seg√©d','seg√©ly','sejt','selyem','semmi','serleg','serpeny≈ë','s√©rv','s√©ta','siga','siker','sikk','sima','s√≠','s√≠n','s√≠p','s√≠r','sir','sir√°ly','s√≠ugr√°s','sivatag','skatulya','smink','smaragd','sodr√°s','s√≥gor','s√≥','sok','s√∂r','sors','s√≥ska','s√≥v√°rg√°s','sprint','sr√°c','start','statiszta','st√©g','st√≠lus','stop','stoppol','strandon','str√°zsa','stressz','str√≥fa','st√∫di√≥','sugallat','sug√°r','sug√°r√∫t','s√∫ly','s√ºndiszn√≥','sushi','suttog√°s','s√ºket','s√ºl','s√ºlt','s≈±r≈±','s√∫rl√≥d√°s','sutty√≥','sv√©d','svindli','szabad','szab√°ly','szab√≥','sz√°j','szak√°cs','szak√°ll','szakasz','szaki','sz√°l','sz√°ll√°s','szalma','szalon','szaloncukor','szalonna','szam√°r','szam√≥ca','sz√°m','sz√°n','sz√°nd√©k','szappan','szar','szarvas','sz√°sz','szatyor','sz√°z','sz√°zad','sz√°zal√©k','szecessi√≥','szeg','szeg√©ly','szeg√©ny','szegf≈±','sz√©k','sz√©l','szellem','szelv√©ny','szem','szem√©ly','szem√©t','szemle','szempilla','szem√ºveg','sz√©n','sz√©na','szendvics','szent','szeptember','szer','szerda','szerelem','szerencse','szeretet','szerkezet','szersz√°m','szerv','szerver','szerviz','szesz','sziget','szign√°l','sz√≠j','szikla','szilva','sz√≠n','szimf√≥nia','szindr√≥ma','sz√≠n√©sz','sz√≠npad','sz√≠nt√©r','szir√©n','szirt','szita','sz√≠v','szivar','szivatty√∫','szleng','szlogen','sz√≥','szoba','szobor','sz√≥da','sz√≥fa','szok√°s','szoknya','szolga','szol√°rium','szoli','szomsz√©d','szomor√∫','sz√≥sta','sz√≥tag','sz√≥t√°r','sz√∂cske','sz√∂g','sz≈ëke','sz≈ël≈ë','sz≈ënyeg','sz√∂rf','sz√∂rny','sz√∂vet','sz√∂vets√©g','sztr√°jk','sztr√°da','sz≈±cs','sz≈±k','sz√ºnet','sz≈±r≈ë','sz≈±z','talaj','tal√°lka','tal√°ny','taliga','talizm√°n','talp','t√°l','t√°lca','t√°m','tan','tan√°cs','tan√°r','t√°nc','tanfolyam','tan√∫','tanul√≥','tanya','t√°ny√©r','tapasz','taps','t√°r','t√°rca','t√°rgy','tarhonya','tarisznya','tarot','t√°rs','t√°ska','tavasz','taxi','tea','te√°trum','technika','teher','teh√©n','tej','t√©l','telefon','telek','t√©ma','temet≈ë','templom','temp√≥','tenger','tenisz','t√©ny','t√©r','terasz','terem','terep','terhes','terv','test','testv√©r','tet≈ë','t√©szta','t√©t','t√©tel','tetov√°l√°s','tett','tettes','t√©v√©','tigris','tikk','tilalom','tinta','t√≠pus','tit√°n','titok','t√≠z','t√≥','toj√°s','tok','tokaji','toll','tolvaj','tomp','t√≥rusz','torta','torz√≥','t√∂bb','t√∂k','t√∂lgy','t√∂meg','t√∂m√©ny','t√∂ml√∂c','t√∂ml≈ë','t√∂rekv√©s','t√∂rl√©s','t√∂rpe','t√∂rt√©net','t√∂rv√©ny','t√∂rzs','t≈ë','t≈ëke','t≈ër','t≈ëzsde','traffipax','trag√©dia','traktor','transz','trap√©z','trapper','tr√©fa','tr√©ning','tr√≥n','tr√≥fea','tr√ºkk','t√∫ls√∫ly','t√∫ra','turb√°n','turi','turista','turn√©','t√∫sz','t√ºd≈ë','t√ºk√∂r','t√∫l','t√∫l√©l≈ë','t√ºcs√∂k','t√ºntet√©s','t≈±','t≈±z','t≈±zfal','t≈±zhely','t≈±zolt√≥','uborka','udvar','ugr√°s','√∫j','√∫jdons√°g','ujj','√∫js√°g','uk√°z','ultra','univerzum','unoka','ur√°n','√∫r','usz√°ly','uszoda','√∫t','utas','utca','√∫tit√°rs','ut√≥pia','ut√≥sz√≥','√º √º √ºnnep','√ºdv','√ºgyn√∂k','√ºres','≈±r','√ºveg','√ºzenet','vad','v√°d','vad√°sz','vadon','vagon','vagy','vagyon','v√°gy','vaj','vakar','vakcina','v√°ll','v√°llalat','vall√°s','v√°lt√≥','v√°mp√≠r','v√°m','v√°r','varangy','v√°ratlan','var√°zs','v√°ros','vas','v√°s√°r','v√°szon','v√°z','v√©c√©','v√©d','v√©g','v√©letlen','v√©lem√©ny','vend√©g','v√©n','v√©ny','verda','ver√©b','vers','verseny','verzi√≥','vese','v√©sz','vesz√©ly','vet√©lked≈ë','vez√©r','vezet≈ë','viasz','vibr√°l√°s','vicc','vide√≥','vidra','vigasz','vil√°g','villa','vill√°m','villany','vir√°g','virtus','v√≠rus','visz√°ly','viszki','vitamin','vitorla','vissza','visszhang','vitatkozik','v√≠z','v√≠zes√©s','v√≠zil√≥','v√≠z√∂nt≈ë','viza','v√≠zum','voks','vonal','vontat√≥','v√∂d√∂r','v≈ëleg√©ny','v√∂lgy','v√∂r√∂s','wc','web','whisky','xilofon','yacht','zacc','zaj','z√°log','zamat','z√°r','zar√°ndok','z√°r√≥jel','z√°szl√≥','zavar','zebu','zeller','zene','zeng','z√©r√≥','zivatar','zodi√°kus','zombi','zongora','z√≥na','zord','z√∂rej','zuhan','zuhan√°s','z√∫zmara','zs√°k','zs√°lya','zsarnok','zsel√©','zsemle','zseni','zseton','zsinag√≥ga','zsinat','zsin√≥r','zsir√°f','zs√≠rkr√©ta','zsok√©','zsoldos','zsolt√°r','zsongl≈ër','zsuga','zsugori','zs≈±ri','zs√∫r'
        ];
        
        const isMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
        const GRID_SIZE = 9, WORD_COUNT = 20, CYCLE_DURATION_MS = 10 * 60 * 1000;
        let wordsToFind = [], wordPositions = new Map(), grid = [], selectedCells = [];
        let foundWords = new Set();
        let isSelectingForDesktop = false;
        let score = 0;
        let riskedScore = 0;
        let isRisking = false;
        let isFreeRound = false;
        let isGameActive = true;
        let gameTimer, nextBoardDate;
        
        let collectedSodaLetters = new Set();
        let activePowerUp = { type: null, expires: 0, desc: '' };
        const SODA_LETTERS = ['SZ', '√ì', 'D', 'A'];
        
        let gameState = { sodaPenz: 0, upgrades: { point_multiplier: 0, discount: 0 }, elixirs: { double_points: 0, magnet: 0 } };

        const mainContent = document.getElementById('main-content');
        const gridContainer = document.getElementById('grid-container');
        const wordListElement = document.getElementById('words');
        const scoreElement = document.getElementById('score');
        const multiplierDisplay = document.getElementById('multiplier-display');
        const rewardsListElement = document.getElementById('rewards-list');
        const piacListElement = document.getElementById('piac-list');
        const newBoardBtn = document.getElementById('new-board-btn');
        const timerDisplay = document.getElementById('timer-display');
        const currentWordPreview = document.getElementById('current-word-preview');
        const megoldasBtn = document.getElementById('megoldas-btn');
        const clearSelectionBtn = document.getElementById('clear-selection-btn');
        const sodaHuntLettersContainer = document.getElementById('soda-hunt-letters');
        const sodaHuntClaimBtn = document.getElementById('soda-hunt-claim-btn');
        const activePowerupDisplay = document.getElementById('active-powerup-display');
        const sodaPenzBalance = document.getElementById('soda-penz-balance');
        const tabNyeremeny = document.getElementById('tab-nyeremeny');
        const tabPiac = document.getElementById('tab-piac');
        const endRoundChoices = document.getElementById('end-round-choices');
        const btnCashIn = document.getElementById('btn-cash-in');
        const btnRiskIt = document.getElementById('btn-risk-it');

        document.addEventListener('DOMContentLoaded', () => {
            mainContent.style.opacity = '1';
            loadGameState();
            startNewRound(0, false);
        });
        
        newBoardBtn.addEventListener('click', () => startNewRound(0, false));
        btnCashIn.addEventListener('click', () => {
            gameState.sodaPenz += Math.floor((score + riskedScore) / 10);
            saveGameState();
            updateSodaPenzDisplay();
            startNewRound(0, false);
        });
        btnRiskIt.addEventListener('click', () => startNewRound(score + riskedScore, true));
        
        megoldasBtn.addEventListener('click', showSolutions);
        clearSelectionBtn.addEventListener('click', clearSelection);
        sodaHuntClaimBtn.addEventListener('click', claimSodaReward);
        tabNyeremeny.addEventListener('click', () => switchTab('nyeremeny'));
        tabPiac.addEventListener('click', () => switchTab('piac'));
        
        function switchTab(tabName) {
            if(tabName === 'nyeremeny') {
                tabNyeremeny.classList.add('active');
                tabPiac.classList.remove('active');
                rewardsListElement.style.display = 'block';
                piacListElement.style.display = 'none';
            } else {
                tabNyeremeny.classList.remove('active');
                tabPiac.classList.add('active');
                rewardsListElement.style.display = 'none';
                piacListElement.style.display = 'block';
            }
        }

        function handleCellTap(cell) {
            if (cell.classList.contains('hint-found') || selectedCells.includes(cell)) return;
            selectCell(cell);
            checkSelectedWord(true);
        }

        function selectionStart(cell) {
            if (!cell || cell.classList.contains('hint-found')) return;
            isSelectingForDesktop = true;
            clearSelection();
            selectCell(cell);
        }

        function selectionMove(cell) {
            if (!isSelectingForDesktop || !cell) return;
            
            if (selectedCells.length > 1 && cell === selectedCells[selectedCells.length - 2]) {
                const lastCell = selectedCells.pop();
                lastCell.classList.remove('selected');
                updateWordPreview();
                return;
            }

            if (cell.classList.contains('selected') || cell.classList.contains('hint-found')) return;
            
            const lastCell = selectedCells[selectedCells.length - 1];
            if (!lastCell) { selectCell(cell); return; }
            
            const r1 = parseInt(lastCell.dataset.row), c1 = parseInt(lastCell.dataset.col);
            const r2 = parseInt(cell.dataset.row), c2 = parseInt(cell.dataset.col);
            
            const dr = r2 - r1;
            const dc = c2 - c1;
            const steps = Math.max(Math.abs(dr), Math.abs(dc));

            if (steps > 1) { 
                for (let i = 1; i <= steps; i++) {
                    const inter_r = r1 + Math.round(i * dr / steps);
                    const inter_c = c1 + Math.round(i * dc / steps);
                    const interCellNode = gridContainer.children[inter_r * GRID_SIZE + inter_c];
                    if (interCellNode && !selectedCells.includes(interCellNode) && !interCellNode.classList.contains('hint-found')) {
                       selectCell(interCellNode);
                    }
                }
            } else if (Math.abs(dr) <= 1 && Math.abs(dc) <= 1) {
                 selectCell(cell);
            }
        }

        function selectionEnd() {
            if (!isSelectingForDesktop) return;
            isSelectingForDesktop = false;
            if (selectedCells.length > 0) {
                checkSelectedWord(false);
            }
        }
        
        function selectCell(cell) {
            selectedCells.push(cell);
            cell.classList.add('selected');
            updateWordPreview();
        }

        function clearSelection() {
            selectedCells.forEach(c => c.classList.remove('selected'));
            selectedCells = [];
            updateWordPreview();
        }

        function updateWordPreview() {
            currentWordPreview.textContent = selectedCells.map(c => c.textContent).join('');
        }

        function checkSelectedWord(isTap) {
            const selectedWord = currentWordPreview.textContent;
            if (wordsToFind.includes(selectedWord) && !foundWords.has(selectedWord)) {
                foundWords.add(selectedWord);
                document.getElementById('word-' + selectedWord).classList.add('found');
                
                if(isWarmupRound) {
                    setTimeout(clearSelection, 100);
                    if (!isTap) clearSelection();
                    return; // Bemeleg√≠t≈ë k√∂rben nincs pont, se b√≥nusz
                }

                let multiplier = 1 + (gameState.upgrades.point_multiplier * 0.05);
                if(isRisking) multiplier *= 2;
                
                selectedCells.forEach(cell => {
                    const r = parseInt(cell.dataset.row);
                    const c = parseInt(cell.dataset.col);
                    const cellData = grid[r][c];

                    if(cellData.hiddenLetter) {
                        collectedSodaLetters.add(cellData.hiddenLetter);
                        cellData.hiddenLetter = null;
                        const icon = cell.querySelector('.hidden-bubble-icon');
                        if(icon) icon.style.opacity = '0';
                        updateSodaHuntUI();
                        saveGameState();
                    }

                    if (isGameActive) {
                        const bonusType = cellData.bonus;
                        if(bonusType) {
                            if(bonusType === 'dp') multiplier *= 2;
                            else if (bonusType === 'time') nextBoardDate = new Date(nextBoardDate.getTime() + 15000);
                            cellData.bonus = null;
                            cell.classList.remove('bonus-dp', 'bonus-time');
                        }
                    }
                });

                if (isGameActive) {
                    if(activePowerUp.type === 'double_points') multiplier *= 2;
                    updateScore((selectedWord.length * 10) * multiplier);
                }

                setTimeout(clearSelection, 100);
            }
            if (!isTap) {
                clearSelection();
            }
        }
        
        function showSolutions() {
            megoldasBtn.disabled = true;
            megoldasBtn.style.display = 'none';
            if(isGameActive) {
                isGameActive = false;
                renderRewards(); 
            }
            wordsToFind.forEach(word => {
                if (!foundWords.has(word)) {
                    const positions = wordPositions.get(word);
                    if (positions) {
                        positions.forEach(pos => {
                            const cell = gridContainer.children[pos.r * GRID_SIZE + pos.c];
                            cell.style.transition = 'background-color 0.5s, box-shadow 0.5s';
                            cell.style.backgroundColor = 'var(--neon-purple)';
                            cell.style.boxShadow = '0 0 15px var(--neon-purple)';
                        });
                    }
                }
            });
        }
        
        function startNewRound(carryOverScore = 0, isRiskingRound = false) {
            isGameActive = true;
            riskedScore = carryOverScore;
            isRisking = isRiskingRound;
            
            const currentSeedStart = Math.floor(Date.now() / CYCLE_DURATION_MS) * CYCLE_DURATION_MS;
            nextBoardDate = new Date(currentSeedStart + CYCLE_DURATION_MS);
            const remainingMilliseconds = nextBoardDate - Date.now();
            
            // A k√∂r elej√©n eld≈ël, hogy szabad k√∂r-e
            isFreeRound = remainingMilliseconds < (9 * 60 * 1000);
            if (isRisking) isFreeRound = false;

            megoldasBtn.style.display = 'none';
            timerDisplay.style.display = 'block';
            newBoardBtn.style.display = 'none';
            endRoundChoices.style.display = 'none';
            multiplierDisplay.style.display = isRisking ? 'block' : 'none';
            
            const timeSeed = Math.floor(Date.now() / CYCLE_DURATION_MS);
            setupNewGame(timeSeed);
            scheduleNextBoard();
        }
        
        function createSeededRandom(seed) { let s = seed; return () => { s = (s * 9301 + 49297) % 233280; return s / 233280; }; }
        function seededShuffle(array, randomFunc) { let i = array.length; while (i) { let j = Math.floor(randomFunc() * i--);[array[i], array[j]] = [array[j], array[i]]; } return array; }
        
        function setupNewGame(seed) {
            megoldasBtn.disabled = false;
            wordsToFind = []; wordPositions.clear(); grid = []; selectedCells = []; foundWords.clear(); score = 0;
            gridContainer.innerHTML = ''; wordListElement.innerHTML = '';
            
            const seededRandom = createSeededRandom(seed);
            
            grid = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(null).map(() => ({ char: '', bonus: null, hiddenLetter: null })));
            
            let wordSelection = seededShuffle([...hungarianWords], seededRandom);
            
            let placedWordsCount = 0;
            while (placedWordsCount < WORD_COUNT && wordSelection.length > 0) {
                let word = wordSelection.pop().toUpperCase();
                if (word.length > GRID_SIZE || word.length < 3) continue;
                let placement = findPlacementForWord(word, grid, seededRandom);
                if (placement) { 
                    wordsToFind.push(word); 
                    wordPositions.set(word, placement.cells); 
                    placement.cells.forEach((cell, i) => { grid[cell.r][cell.c].char = word[i]; }); 
                    placedWordsCount++; 
                }
            }
            
            fillGridWithRandomLetters(seededRandom);
            placeBonusFields(seededRandom);
            placeSodaLetters(seededRandom);
            renderGrid(); renderWordList(); updateScore(0);
        }
        
        function placeBonusFields(randomFunc) {
            const emptyCells = getEmptyCells();
            seededShuffle(emptyCells, randomFunc);
            
            let bonusCount = 2;
            if (activePowerUp.type === 'bonus_rain') bonusCount = 5;

            for(let i=0; i<bonusCount; i++) if(emptyCells.length > 0) { const pos = emptyCells.pop(); if(pos) grid[pos.r][pos.c].bonus = 'dp'; }
            if(emptyCells.length > 0) { const pos = emptyCells.pop(); if(pos) grid[pos.r][pos.c].bonus = 'time'; }
            if (activePowerUp.type === 'bonus_rain' && emptyCells.length > 0) { const pos = emptyCells.pop(); if(pos) grid[pos.r][pos.c].bonus = 'time'; }
            if (activePowerUp.type === 'bonus_rain' && emptyCells.length > 0) { const pos = emptyCells.pop(); if(pos) grid[pos.r][pos.c].bonus = 'time'; }
        }
        
        function placeSodaLetters(randomFunc) {
            const emptyCells = getEmptyCells();
            seededShuffle(emptyCells, randomFunc);

            const lettersToPlace = [...SODA_LETTERS, SODA_LETTERS[Math.floor(randomFunc() * SODA_LETTERS.length)]];
            for(const letter of lettersToPlace) {
                if(emptyCells.length > 0) {
                    const pos = emptyCells.pop();
                    if(pos) grid[pos.r][pos.c].hiddenLetter = letter;
                }
            }
        }
        
        function getEmptyCells() {
            const emptyCells = [];
            const wordCoords = new Set();
            wordPositions.forEach(positions => { positions.forEach(pos => wordCoords.add(`${pos.r}-${pos.c}`)); });

            for(let r=0; r<GRID_SIZE; r++) {
                for(let c=0; c<GRID_SIZE; c++) {
                    if(!wordCoords.has(`${r}-${c}`)) {
                        emptyCells.push({r, c});
                    }
                }
            }
            return emptyCells;
        }

        function findPlacementForWord(word, currentGrid, randomFunc) {
            let attempts = 0;
            while (attempts < 100) {
                let path = [{ r: Math.floor(randomFunc() * GRID_SIZE), c: Math.floor(randomFunc() * GRID_SIZE) }];
                for (let i = 1; i < word.length; i++) {
                    let lastPos = path[i - 1]; 
                    let neighbors = getNeighbors(lastPos.r, lastPos.c, path);
                    seededShuffle(neighbors, randomFunc);
                    if (neighbors.length === 0) break;
                    path.push(neighbors[0]);
                }
                if (path.length === word.length) {
                    let canPlace = true;
                    for (let i = 0; i < word.length; i++) { if (currentGrid[path[i].r][path[i].c].char !== '' && currentGrid[path[i].r][path[i].c].char !== word[i]) { canPlace = false; break; } }
                    if (canPlace) return { cells: path };
                }
                attempts++;
            }
            return null;
        }

        function getNeighbors(r, c, exclude) {
            const neighbors = [];
            const moves = [ { dr: -1, dc: 0 }, { dr: 1, dc: 0 }, { dr: 0, dc: -1 }, { dr: 0, dc: 1 } ];

            for (const move of moves) {
                const nr = r + move.dr;
                const nc = c + move.dc;
                if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE && !exclude.some(p => p.r === nr && p.c === nc)) {
                    neighbors.push({ r: nr, c: nc });
                }
            }
            return neighbors;
        }
        
        function fillGridWithRandomLetters(randomFunc) { 
            const alphabet = 'A√ÅBCDE√âFGHI√çJKLMNO√ì√ñ≈êPQRSTU√ö√ú≈∞VWXYZ'; 
            for (let i = 0; i < GRID_SIZE; i++) 
                for (let j = 0; j < GRID_SIZE; j++) 
                    if (grid[i][j].char === '') grid[i][j].char = alphabet[Math.floor(randomFunc() * alphabet.length)]; 
        }
        
        function renderGrid() {
            gridContainer.innerHTML = '';
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const cellData = grid[i][j];
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.textContent = cellData.char;
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    if(cellData.bonus === 'dp') cell.classList.add('bonus-dp');
                    if(cellData.bonus === 'time') cell.classList.add('bonus-time');
                    if(cellData.hiddenLetter) {
                        const icon = document.createElement('div');
                        icon.className = 'hidden-bubble-icon';
                        cell.appendChild(icon);
                    }

                    cell.style.backgroundColor = '';
                    cell.style.boxShadow = '';
                    cell.style.transition = '';

                    if (isMobile) {
                        cell.addEventListener('touchstart', (e) => { e.preventDefault(); selectionStart(cell); }, { passive: false });
                        cell.addEventListener('touchmove', (e) => { 
                            e.preventDefault();
                            const touch = e.touches[0];
                            const targetCell = document.elementFromPoint(touch.clientX, touch.clientY);
                            if(targetCell && targetCell.classList.contains('grid-cell')) {
                                selectionMove(targetCell);
                            }
                        }, { passive: false });
                        cell.addEventListener('touchend', (e) => { e.preventDefault(); selectionEnd(); });
                    } else {
                        cell.addEventListener('mousedown', () => selectionStart(cell));
                        cell.addEventListener('mouseover', () => selectionMove(cell));
                    }
                    gridContainer.appendChild(cell);
                }
            }
            if (!isMobile) {
                document.addEventListener('mouseup', selectionEnd);
            }
        }

        function renderWordList() { wordListElement.innerHTML = ''; const words = [...wordsToFind].sort((a,b) => a.localeCompare(b)); words.forEach(word => { const li = document.createElement('li'); li.textContent = word; li.id = 'word-' + word; if (foundWords.has(word)) li.classList.add('found'); wordListElement.appendChild(li); }); }

        const rewards = [ { id: 'vowel_hint', name: 'Mag√°nhangz√≥ Tipp', desc: 'Megjel√∂li egy sz√≥ mag√°nhangz√≥it.', cost: 1000, action: vowelHint }, { id: 'point_bonus', name: 'Pont B√≥nusz', desc: '+200 pont.', cost: 1500, action: () => updateScore(200) }, { id: 'reveal_letter', name: 'Bet≈± Felfed√©se', desc: 'Felvillant egy bet≈±t egy sz√≥b√≥l.', cost: 2000, action: revealLetter }, { id: 'first_letter', name: 'Els≈ë Bet≈±', desc: 'V√©glegesen megjel√∂li egy sz√≥ els≈ë bet≈±j√©t.', cost: 4000, action: revealFirstLetter }, { id: 'glimpse_word', name: 'Sz√≥pillant√°s', desc: 'Felvillantja egy sz√≥ √∫tvonal√°t.', cost: 7500, action: glimpseWord }, { id: 'free_pass', name: 'Ingyen Passz', desc: 'Megtal√°lja a legr√∂videbb hi√°nyz√≥ sz√≥t.', cost: 12000, action: findShortestWord }];
        const piacItems = [
            { id: 'point_multiplier', name: 'Sz√©nsav-Inf√∫zi√≥', desc: 'V√©glegesen +5% pontot ad minden sz√≥√©rt.', baseCost: 2500, action: (item) => { gameState.upgrades.point_multiplier++; } },
            { id: 'discount', name: 'T√∂rzsv√°s√°rl√≥i K√°rtya', desc: 'V√©glegesen -10% kedvezm√©ny a Nyerem√©nyboltban.', baseCost: 4000, action: (item) => { gameState.upgrades.discount++; } },
            { id: 'elixir_double_points', name: 'Arany-Sz√≥da', desc: 'A k√∂vetkez≈ë k√∂rben minden pont dupl√°n sz√°m√≠t.', cost: 5000, action: (item) => { gameState.elixirs.double_points++; } },
            { id: 'elixir_magnet', name: 'M√°gneses Bubor√©k', desc: 'A k√∂vetkez≈ë k√∂rben garant√°ltan megtal√°lod a hi√°nyz√≥ SZ√ìDA bet≈±ket.', cost: 7500, action: (item) => { gameState.elixirs.magnet++; } }
        ];

        function updateScore(points) { score = Math.max(0, score + points); scoreElement.textContent = Math.floor(score + riskedScore); renderRewards(); renderPiac(); }
        
        function renderRewards() { 
            rewardsListElement.innerHTML = ''; 
            rewards.forEach(r => { 
                let currentCost = Math.floor(r.cost * (1 - (gameState.upgrades.discount * 0.1)));
                const isAffordable = score >= currentCost;
                const el = document.createElement('div'); 
                el.className = 'reward-item ' + (isAffordable && isGameActive && !isWarmupRound ? 'affordable' : 'disabled'); 
                el.innerHTML = `<div class="reward-name">${r.name}</div><div class="reward-desc">${r.desc}</div><div class="reward-cost">${currentCost} Pont</div>`; 
                if (isAffordable && isGameActive && !isWarmupRound) el.onclick = () => { if (score >= currentCost) { updateScore(-currentCost); r.action(); } }; 
                rewardsListElement.appendChild(el); 
            }); 
        }

        function renderPiac() {
            piacListElement.innerHTML = '';
            piacItems.forEach(item => {
                let currentCost = item.cost;
                if(item.baseCost) {
                    currentCost = Math.floor(item.baseCost * Math.pow(1.5, gameState.upgrades[item.id] || 0));
                }
                const isAffordable = gameState.sodaPenz >= currentCost;
                const el = document.createElement('div');
                el.className = 'reward-item piac-item ' + (isAffordable ? 'affordable' : 'disabled');
                el.innerHTML = `<div class="reward-name">${item.name} ${gameState.upgrades[item.id] ? `(Szint ${gameState.upgrades[item.id] + 1})` : ''}</div><div class="reward-desc">${item.desc}</div><div class="piac-cost">${currentCost} SZP</div>`;
                if(isAffordable) el.onclick = () => buyPiacItem(item, currentCost);
                piacListElement.appendChild(el);
            });
        }

        function buyPiacItem(item, cost) {
            if (gameState.sodaPenz >= cost) {
                gameState.sodaPenz -= cost;
                item.action(item);
                saveGameState();
                updateSodaPenzDisplay();
                renderPiac();
            }
        }
        
        function getUnfoundWord(shortest = false) { let unfound = wordsToFind.filter(w => !foundWords.has(w)); if (unfound.length === 0) return null; if (shortest) unfound.sort((a,b) => a.length - b.length); return unfound[0]; }
        function vowelHint() { const word = getUnfoundWord(); if (!word) return; const vowels = "A√ÅE√âI√çO√ì√ñ≈êU√ö√ú≈∞"; document.getElementById('word-' + word).innerHTML = word.split('').map(l => vowels.includes(l) ? `<span style="color: var(--neon-amber);">${l}</span>` : l).join(''); }
        function revealLetter() { const word = getUnfoundWord(); if (!word) return; const pos = wordPositions.get(word); const cellInfo = pos[Math.floor(Math.random() * pos.length)]; const cell = gridContainer.children[cellInfo.r * GRID_SIZE + cellInfo.c]; cell.classList.add('solution-path'); setTimeout(() => cell.classList.remove('solution-path'), 1000); }
        function revealFirstLetter() { const word = getUnfoundWord(); if (!word) return; const cellInfo = wordPositions.get(word)[0]; gridContainer.children[cellInfo.r * GRID_SIZE + cellInfo.c].classList.add('hint-found'); }
        function glimpseWord() { const word = getUnfoundWord(); if (!word) return; const positions = wordPositions.get(word); positions.forEach(p => { const cell = gridContainer.children[p.r * GRID_SIZE + p.c]; cell.classList.add('solution-path'); setTimeout(() => cell.classList.remove('solution-path'), 1000); }); }
        function findShortestWord() { const wordToFind = getUnfoundWord(true); if (!wordToFind) return; foundWords.add(wordToFind); document.getElementById('word-' + wordToFind).classList.add('found'); if (isGameActive && !isWarmupRound) updateScore(wordToFind.length * 10); }

        function endRound() {
            if (!isGameActive) return;
            isGameActive = false;
            clearInterval(gameTimer);

            if(isRisking && foundWords.size < WORD_COUNT) {
                riskedScore = 0;
                score = 0;
                updateScore(0);
                alert("Sajnos nem tal√°ltad meg az √∂sszes sz√≥t! A kock√°ztatott pontok elvesztek.");
                startNewRound(0, false);
                return;
            }

            timerDisplay.style.display = 'none';
            if(score + riskedScore > 0 && !isFreeRound) {
                endRoundChoices.style.display = 'flex';
            } else {
                if (score + riskedScore > 0) {
                    gameState.sodaPenz += Math.floor((score + riskedScore) / 10);
                    saveGameState();
                    updateSodaPenzDisplay();
                }
                newBoardBtn.style.display = 'block';
            }
            
            if(!megoldasBtn.disabled) {
                megoldasBtn.style.display = 'block';
            }
            renderRewards();
        }
        
        function scheduleNextBoard() {
            if (gameTimer) clearInterval(gameTimer);
            
            const checkTime = () => {
                const now = new Date();
                const remainingMilliseconds = nextBoardDate - now;

                if (remainingMilliseconds <= 0 && isGameActive) {
                    endRound();
                    return;
                }

                if(isGameActive) {
                    const minutes = Math.floor(remainingMilliseconds / 60000);
                    const seconds = Math.floor((remainingMilliseconds % 60000) / 1000);

                    if(isFreeRound) {
                        const targetTime = nextBoardDate.toLocaleTimeString('hu-HU', { hour: '2-digit', minute: '2-digit' });
                        timerDisplay.textContent = `Bemeleg√≠t≈ë K√∂r (√âles j√°t√©k: ${targetTime}-kor)`;
                        timerDisplay.classList.add('warmup-round');
                    } else {
                        timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                        timerDisplay.classList.remove('warmup-round');
                    }

                    if (remainingMilliseconds <= 60000 && !megoldasBtn.disabled) {
                        megoldasBtn.style.display = 'block';
                    } else if (!megoldasBtn.disabled) {
                        megoldasBtn.style.display = 'none';
                    }
                }
            };

            checkTime();
            gameTimer = setInterval(checkTime, 1000);
        }

        function updateSodaHuntUI() {
            let allCollected = SODA_LETTERS.every(letter => collectedSodaLetters.has(letter));
            
            sodaHuntLettersContainer.querySelectorAll('span').forEach(span => {
                const letter = span.dataset.letter;
                if (collectedSodaLetters.has(letter)) {
                    span.classList.add('collected');
                } else {
                    span.classList.remove('collected');
                }
            });

            if (allCollected) {
                sodaHuntClaimBtn.style.display = 'block';
                sodaHuntLettersContainer.style.display = 'none';
            } else {
                sodaHuntClaimBtn.style.display = 'none';
                sodaHuntLettersContainer.style.display = 'flex';
            }
            
            if (activePowerUp && activePowerUp.expires > Date.now()) {
                activePowerupDisplay.textContent = `Akt√≠v b√≥nusz: ${activePowerUp.desc}`;
            } else {
                activePowerupDisplay.textContent = '';
            }
        }
        
        function claimSodaReward() {
            const powerups = [
                { type: 'double_points', desc: 'Pontdupl√°z√≥' },
                { type: 'bonus_rain', desc: 'B√≥nusz Es≈ë' }
            ];
            const randomPowerup = powerups[Math.floor(Math.random() * powerups.length)];

            activePowerUp = {
                type: randomPowerup.type,
                expires: Date.now() + 24 * 60 * 60 * 1000,
                desc: randomPowerup.desc
            };
            
            collectedSodaLetters.clear();
            updateSodaHuntUI();
            saveGameState();
            alert(`Gratul√°lunk! Egy "${activePowerUp.desc}" b√≥nuszt kapt√°l 24 √≥r√°ra!`);
        }
        
        function updateSodaPenzDisplay() {
            sodaPenzBalance.textContent = gameState.sodaPenz;
        }

        function saveGameState() {
            const fullGameState = {
                ...gameState,
                collectedLetters: Array.from(collectedSodaLetters),
                activePowerUp: activePowerUp
            };
            localStorage.setItem('sodaGameState', JSON.stringify(fullGameState));
        }

        function loadGameState() {
            const savedState = localStorage.getItem('sodaGameState');
            if (savedState) {
                const loadedState = JSON.parse(savedState);
                gameState.sodaPenz = loadedState.sodaPenz || 0;
                gameState.upgrades = loadedState.upgrades || { point_multiplier: 0, discount: 0 };
                gameState.elixirs = loadedState.elixirs || { double_points: 0, magnet: 0 };
                
                collectedSodaLetters = new Set(loadedState.collectedLetters);
                
                if (loadedState.activePowerUp && loadedState.activePowerUp.expires > Date.now()) {
                    activePowerUp = loadedState.activePowerUp;
                } else {
                    activePowerUp = { type: null, expires: 0, desc: '' };
                }
            }
            updateSodaPenzDisplay();
            updateSodaHuntUI();
            renderPiac();
        }

    </script>
</body>
</html>
