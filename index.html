            .logo-text { font-size: 3.5em; }

            #grid-container {
                width: 95vw; max-width: 480px; height: 95vw; max-height: 480px;
                grid-template-columns: repeat(9, 1fr); gap: 1.1vw; padding: 1.5vw;
            }
            .grid-cell { font-size: clamp(14px, 5.5vw, 30px); border-radius: 1vw; }
            #current-word-container { height: 40px; }
            #current-word-preview { font-size: 1.5em; }
            #words li { font-size: 1.1em; padding: 6px 8px;}
            #clear-selection-btn { display: block; }
            
            #words { max-height: 25vh; }
            #rewards-list { max-height: 25vh; }
        }
    </style>
</head>
<body>
    <div id="main-content">
        <div id="game-layout">
            <div id="left-column">
                <div id="word-list-container" class="panel">
                    <div class="panel-inner">
                        <div id="timer-container">
                            <div id="timer-display"></div>
                        </div>
                        <h3>KERESENDŐ SZAVAK</h3>
                        <ul id="words"></ul>
                        <div id="new-board-container">
                            <button id="new-board-main-btn">Frissítem a szódát</button>
                        </div>
                        <div class="panel-bottom-section">
                            <div id="solution-container">
                                <button id="megoldas-btn">Megoldás Felfedése</button>
                            </div>
                            <div id="score-container"><h3>PONTOK</h3><div id="score">0</div></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="center-column">
                <div id="logo-container">
                    <div class="static-bubble sb1"></div><div class="static-bubble sb2"></div>
                    <div class="static-bubble sb3"></div><div class="static-bubble sb4"></div>
                    <div class="logo-text">Szóda</div>
                </div>
                <div id="grid-container"></div>
                <div id="current-word-container">
                    <div id="current-word-preview"></div>
                    <button id="clear-selection-btn">Törlés</button>
                </div>
            </div>
            <div id="right-column">
                <div id="rewards-container" class="panel">
                    <div class="panel-inner">
                        <h3>NYEREMÉNYBOLT</h3>
                        <div id="rewards-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const hungarianWords = [
            'ablak','abszurd','acél','adat','adoma','adottság','áfonya','ág','ágy','agy','ajak','ajándék','ajtó','akarat','akció','akna','alagút','alak','alakulat','alkalom','alkalmazás','alkotás','alkotmány','alku','áll','állam','állat','állomás','álom','ámen','amőba','ampulla','amulett','anekdota','angyal','antenna','anya','anyag','apa','ápoló','apró','áram','arany','aranyos','arc','árok','árpa','áruló','ás','ásatás','átok','autó','avar','azonos','bábu','bajnok','bakter','bal','baleset','balett','balta','bálvány','bánat','banda','bank','bár','barack','bárány','barát','barlang','barna','báró','bástya','bátor','bátrán','bazár','bébi','becsület','béka','béke','bélyeg','bér','berek','beteg','beton','betű','bicikli','bika','bilincs','birtok','bit','bizalom','biztos','blúz','bocs','bocsánat','bodza','bója','bokor','bolt','bolygó','bomba','bor','borbély','borda','bőr','bors','bot','bozót','bögre','bölcs','bölcső','börtön','bőven','búcsú','bura','burgonya','bútor','búvár','bűvész','bűz','cápa','cár','celeb','cél','cella','ceruza','cica','cigány','cikk','cikornya','cím','címer','cipő','cirkusz','citrom','civil','comb','cudar','cukor','cumi','cáfolat','csáb','család','csap','csapat','csapda','csata','csavar','csel','csempe','csend','csengő','cser','csere','cserép','csésze','csiga','csík','csillag','csípő','csirke','csizma','csoda','csók','csomag','csomó','csónak','csont','csoport','cső','csőr','csúcs','csütörtök','dada','dal','dallam','dáma','dara','darázs','dárda','dátum','december','defekt','dekoltázs','dél','delfin','delta','démon','derék','dervis','design','deszka','detektív','deviza','diadém','diák','dicsőség','diktátor','dilemma','dinamit','dinnye','dió','diploma','dísz','disznó','divat','dob','doboz','dohány','doktor','dolog','domb','döntés','dosszié','dózse','dőzs','dráma','drága','droid','duda','duma','düh','dzsem','dzseki','dzsip','dzsungel','eb','ebéd','ecet','éden','edény','edző','ég','egér','egész','egészség','egyetem','egyház','együtt','éj','éjfél','ékszer','elme','élmény','előny','ember','emelet','emlék','emlős','ének','energia','epizód','epres','ér','érc','érdem','erdő','eredet','eredmény','erény','eresz','erő','erőd','erős','érték','érv','esély','eskü','eső','este','ész','észak','eszme','eszperente','eszpresszó','étel','élet','érem','év','ezer','ezredes','fagyi','fagy','faj','fájdalom','fal','falat','falu','far','farag','farok','farkas','farm','farmer','farsang','fátyol','fecske','fegyver','fehér','fej','fejfa','fék','fekete','feladat','felelet','felhő','fél','félelem','fém','fenék','fenyő','férfi','féreg','festék','fésű','fészek','fiaskó','fiatal','fiú','film','filozófia','finom','fiók','fizika','foci','fog','fogoly','fogyás','fóka','fok','fólia','folt','folyamat','folyó','folyosó','fonál','font','forgalom','forint','forma','forrás','forradalom','fotel','fotó','fő','főnök','föld','főút','főváros','főzelék','főzés','friss','front','fullánk','furcsa','fúró','füge','függöny','fű','fürdő','fűrész','fürj','füst','füzet','fűzfa','galamb','gallér','garázs','gazda','gáz','gém','gén','gepárd','gép','gésa','gesztus','gida','giliszta','gimnázium','gipsz','gitár','gladiátor','glória','góbé','gól','golyó','gomb','gomba','gond','gondola','gong','gömb','göndör','göngy','görcs','görény','görög','gőz','gránát','gránit','gróf','gúla','gumi','gúny','gyalog','gyám','gyár','gyász','gyémánt','gyep','gyerek','gyertek','gyertya','gyík','gyilkos','gyógyír','gyökér','gyöngy','gyors','győzelem','gyufa','gyűrű','gyümölcs','ha','hab','had','hagyma','haj','hajnal','hajó','hal','halál','háló','halszálka','hamis','hamu','hang','hangár','hangszer','hangya','harag','harang','harc','harisnya','hárfa','hasonló','has','hat','hatalom','határ','hát','hattyú','havas','ház','hegedű','hegy','héj','hely','helyes','henger','herceg','hering','hét','hétfő','hétvége','hiány','hiba','híd','hideg','himnusz','hinta','hír','hitel','hit','hivatás','hó','hód','hold','holló','homár','homok','honlap','hónap','hordó','horgony','horgász','horoszkóp','hossz','hosszú','hotel','hóvirág','hulla','humor','hurka','hús','húsvét','huzat','hű','hűség','idomár','idő','iker','ikon','illat','illúzió','impala','impulzus','index','indigó','indíték','infó','inger','ing','iroda','irónia','iskola','isten','iszap','ital','ítélet','íz','izom','izzó','jacht','jaguár','jak','január','járda','jáspis','játék','javas','jávorszarvas','jég','jel','jelenség','jellem','jelmez','jelölt','jelvény','jenki','jet','jód','jóga','joghurt','jog','joker','jós','jóság','jövő','július','június','juta','jutalom','kabal','kabát','kabin','kacaj','kacsa','kád','kakas','kakaó','kaktusz','kalap','kalauz','kalóz','kályha','kamion','kámpa','kanál','kancellár','kandúr','kánikula','kanna','káosz','kapa','kaparó','kapcsoló','kapitány','kápolna','káposzta','kapu','kar','karabiner','karakter','karám','karát','karaván','kard','karnevál', 'kártya','kastély','katalógus','katona','kaució','kávé','kazán','kecske','kedd','kedves','kefe','kék','kém','kép','kérdés','kerék','kereszt','keret','kert','kés','keserű','kész','kettő','kever','kéz','kincs','király','kis','kocka','kocsi','kód','köd','kő','kölcsön','költő','kölyök','kömény','könny','könyv','könnyű','kör','kormány','korona','korsó','korzó','kórház','kosár','kosz','kota','kovács','kotor','köz','közeg','közép','közös','kréta','krimi','kripta','kristály','kritika','krokodil','krumpli','kút','kutya','kuvasz','küld','külső','kürt','kvíz','láb','labor','lábszár','láda','lakás','lakat','lakodalmas','láng','lanka','lant','lap','lapát','lassan','lát','látvány','láva','láz','lecke','legenda','légió','légszomj','légy','lehel','lélek','lemez','lencse','lepke','lét','létra','levél','leves','lexikon','liba','lift','liga','likőr','lila','limbó','limit','limonádé','link','líra','lista','ló','lobog','logika','logó','lokál','lomb','lop','lottó','lovag','lóerő','lő','lök','löncs','lucfenyő','lúd','luk','lyuk','macska','madár','mag','mágia','mágnes','magyar','máj','majom','makk','makréla','málna','malom','mályva','mandula','mankó','marad','maraton','marcipán','márga','marha','márka','márvány','más','masina','masni','maszk','matematika','matrica','matróz','medál','medence','meder','medve','méh','mély','menedzser','menny','menü','mér','merénylet','mese','messze','mester','metál','metró','méz','mező','miazma','mikrofon','mikulás','milliárd','milliomos','miniszter','minta','mínusz','mirigy','mise','mitológia','mítosz','mizéria','moha','móka','mókus','molekula','móló','monitor','monokli','monoton','motor','mozi','muzsika','mű','műfaj','műhely','műsor','művész','művelet','nád','nadrág','nagy','naiv','nap','napló','narancs','nárcisz','nász','nátha','négy','négyzet','nép','név','néző','nindzsa','nő','nóta','nővér','nugát','nulla','nyáj','nyak','nyál','nyár','nyárs','nyelv','nyer','nyereg','nyers','nyest','nyíl','nyolc','nyom','nyugalom','nyugat','nyúl','nyúlékony','nyüszít','oázis','obeliszk','objektív','oboa','ócéán','óda','odú','ok','okker','oklevél','okos','október','oktogon','olaj','olasz','oldal','olló','ólom','oltár','olvas','olívabogyó','olyan','omlett','opera','opció','optika','óra','orbáncfű','orchidea','ordináta','orgona','orkán','orom','orosz','orrszarvú','orvos','ostor','ostya','oszlop','oszt','osztály','otthon','öv','özön','őz','pad','padlás','padlizsán','pajkos','pajzs','pákó','pálca','pálma','pálya','páncél','pandúr','panel','pánik','panna','panoráma','pap','papagáj','papír','paprika','papucs','paradicsom','parafa','parancs','parázs','park','párna','pár','párt','part','pasi','passz','paszta','pata','patak','pátens','patika','patkány','páva','pazarlás','peca','pecsét','pedál','pék','pelikán','pemzli','péntek','pénz','pepita','perec','per','peron','persze','pestis','petárda','petrezselyem','pezsgő','pia','piac','piccolo','pihen','pikkely','piktogram','pillanat','pille','pillér','pilóta','pince','pingvin','pinty','pipa','piros','pisztoly','pite','pizsama','placc','plafon','plakát','plankton','pláza','pletyka','plüss','pó','pogácsa','pohár','póker','pók','pokol','polc','polip','politika','pollen','póló','póni','pont','ponty','por','porcelán','porc','poros','porta','portré','posta','poszáta','potya','póz','póker','pörkölt','pötty','prizma','próba','probléma','professzor','program','projekt','próféta','proletár','prospektus','protein','prototípus','púder','puding','pulyka','pumpa','pult','púp','puska','puszi','püspök','rab','rács','radar','radír','rag','ragu','ragyog','raj','rajz','rák','rakéta','ral','randi','rang','rántás','rádió','reakció','reál','recept','reccs','reggae','reggeli','rejtély','reklám','remek','remény','rend','rendszer','repce','repeta','répa','repesz','reptér','rés','rész','rét','retesz','retró','reuma','revolver','rezgés','réz','riadó','ribizli','rigó','rikkancs','ring','riport','ritmus','rituálé','rizs','robot','robban','roham','rokkant','rokon','róka','rom','románc','rossz','rosta','rost','rovar','rozmár','rozs','rögbi','röplabda','rövid','rőzse','rúbel','rubin','rúd','ruha','rúna','rúzs','sajt','sakk','sakál','sál','salak','saláta','sámán','sampion','sánc','sár','sárga','sárkány','sarok','sas','sátor','sav','savanyú','seb','sebész','séf','segéd','segély','sejt','selyem','semmi','serleg','serpenyő','sérv','séta','siga','siker','sikk','sima','sí','sín','síp','sír','sir','sirály','síugrás','sivatag','skatulya','smink','smaragd','sodrás','sógor','só','sok','sör','sors','sóska','sóvárgás','sprint','srác','start','statiszta','stég','stílus','stop','stoppol','strandon','strázsa','stressz','strófa','stúdió','sugallat','sugár','sugárút','súly','sündisznó','sushi','suttogás','süket','sül','sült','sűrű','súrlódás','suttyó','svéd','svindli','szabad','szabály','szabó','száj','szakács','szakáll','szakasz','szaki','szál','szállás','szalma','szalon','szaloncukor','szalonna','szamár','szamóca','szám','szán','szándék','szappan','szar','szarvas','szász','szatyor','száz','század','százalék','szecessió','szeg','szegély','szegény','szegfű','szék','szél','szellem','szelvény','szem','személy','szemét','szemle','szempilla','szemüveg','szén','széna','szendvics','szent','szeptember','szer','szerda','szerelem','szerencse','szeretet','szerkezet','szerszám','szerv','szerver','szerviz','szesz','sziget','szignál','szíj','szikla','szilva','szín','szimfónia','szindróma','színész','színpad','színtér','szirén','szirt','szita','szív','szivar','szivattyú','szleng','szlogen','szó','szoba','szobor','szóda','szófa','szokás','szoknya','szolga','szolárium','szoli','szomszéd','szomorú','szósta','szótag','szótár','szöcske','szög','szőke','szőlő','szőnyeg','szörf','szörny','szövet','szövetség','sztrájk','sztráda','szűcs','szűk','szünet','szűrő','szűz','talaj','találka','talány','taliga','talizmán','talp','tál','tálca','tám','tan','tanács','tanár','tánc','tanfolyam','tanú','tanuló','tanya','tányér','tapasz','taps','tár','tárca','tárgy','tarhonya','tarisznya','tarot','társ','táska','tavasz','taxi','tea','teátrum','technika','teher','tehén','tej','tél','telefon','telek','téma','temető','templom','tempó','tenger','tenisz','tény','tér','terasz','terem','terep','terhes','terv','test','testvér','tető','tészta','tét','tétel','tetoválás','tett','tettes','tévé','tigris','tikk','tilalom','tinta','típus','titán','titok','tíz','tó','tojás','tok','tokaji','toll','tolvaj','tomp','tórusz','torta','torzó','több','tök','tölgy','tömeg','tömény','tömlöc','tömlő','törekvés','törlés','törpe','történet','törvény','törzs','tő','tőke','tőr','tőzsde','traffipax','tragédia','traktor','transz','trapéz','trapper','tréfa','tréning','trón','trófea','trükk','túlsúly','túra','turbán','turi','turista','turné','túsz','tüdő','tükör','túl','túlélő','tücsök','tüntetés','tű','tűz','tűzfal','tűzhely','tűzoltó','uborka','udvar','ugrás','új','újdonság','ujj','újság','ukáz','ultra','univerzum','unoka','urán','úr','uszály','uszoda','út','utas','utca','útitárs','utópia','utószó','ü ü ünnep','üdv','ügynök','üres','űr','üveg','üzenet','vad','vád','vadász','vadon','vagon','vagy','vagyon','vágy','vaj','vakar','vakcina','váll','vállalat','vallás','váltó','vámpír','vám','vár','varangy','váratlan','varázs','város','vas','vásár','vászon','váz','vécé','véd','vég','véletlen','vélemény','vendég','vén','vény','verda','veréb','vers','verseny','verzió','vese','vész','veszély','vetélkedő','vezér','vezető','viasz','vibrálás','vicc','videó','vidra','vigasz','világ','villa','villám','villany','virág','virtus','vírus','viszály','viszki','vitamin','vitorla','vissza','visszhang','vitatkozik','víz','vízesés','víziló','vízöntő','viza','vízum','voks','vonal','vontató','vödör','vőlegény','völgy','vörös','wc','web','whisky','xilofon','yacht','zacc','zaj','zálog','zamat','zár','zarándok','zárójel','zászló','zavar','zebu','zeller','zene','zeng','zéró','zivatar','zodiákus','zombi','zongora','zóna','zord','zörej','zuhan','zuhanás','zúzmara','zsák','zsálya','zsarnok','zselé','zsemle','zseni','zseton','zsinagóga','zsinat','zsinór','zsiráf','zsírkréta','zsoké','zsoldos','zsoltár','zsonglőr','zsuga','zsugori','zsűri','zsúr'
        ];
        
        const isMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
        const GRID_SIZE = 9, WORD_COUNT = 10, CYCLE_DURATION_MS = 5 * 60 * 1000;
        let wordsToFind = [], wordPositions = new Map(), grid = [], selectedCells = [];
        let foundWords = new Set();
        let isSelectingForDesktop = false;
        let score = 0;
        let isGameActive = true;
        let gameTimer;
        
        const mainContent = document.getElementById('main-content');
        const gridContainer = document.getElementById('grid-container');
        const wordListElement = document.getElementById('words');
        const wordListContainer = document.getElementById('word-list-container');
        const wordListTitle = wordListContainer.querySelector('h3');
        const scoreElement = document.getElementById('score');
        const rewardsListElement = document.getElementById('rewards-list');
        const newBoardMainBtn = document.getElementById('new-board-main-btn');
        const newBoardContainer = document.getElementById('new-board-container');
        const timerDisplay = document.getElementById('timer-display');
        const currentWordPreview = document.getElementById('current-word-preview');
        const megoldasBtn = document.getElementById('megoldas-btn');
        const clearSelectionBtn = document.getElementById('clear-selection-btn');

        document.addEventListener('DOMContentLoaded', () => {
            mainContent.style.opacity = '1';
            startNewRound();
        });
        
        newBoardMainBtn.addEventListener('click', startNewRound);
        megoldasBtn.addEventListener('click', showSolutions);
        clearSelectionBtn.addEventListener('click', clearSelection);
        
        function handleCellTap(cell) {
            if (!isGameActive || cell.classList.contains('hint-found') || selectedCells.includes(cell)) return;
            selectCell(cell);
            checkSelectedWord(true);
        }

        function selectionStart(cell) {
            if (!isGameActive || !cell || cell.classList.contains('hint-found')) return;
            isSelectingForDesktop = true;
            clearSelection();
            selectCell(cell);
        }

        function selectionMove(cell) {
            if (!isGameActive || !isSelectingForDesktop || !cell) return;

            if (selectedCells.length > 1 && cell === selectedCells[selectedCells.length - 2]) {
                const lastCell = selectedCells.pop();
                lastCell.classList.remove('selected');
                updateWordPreview();
                return;
            }

            if (cell.classList.contains('selected') || cell.classList.contains('hint-found')) return;
            
            const lastCell = selectedCells[selectedCells.length - 1];
            if (!lastCell) return;
            
            const r1 = parseInt(lastCell.dataset.row), c1 = parseInt(lastCell.dataset.col);
            const r2 = parseInt(cell.dataset.row), c2 = parseInt(cell.dataset.col);
            
            const dr = r2 - r1;
            const dc = c2 - c1;
            const steps = Math.max(Math.abs(dr), Math.abs(dc));

            if (steps > 0) {
                for (let i = 1; i <= steps; i++) {
                    const inter_r = r1 + Math.round(i * dr / steps);
                    const inter_c = c1 + Math.round(i * dc / steps);
                    const interCellNode = gridContainer.children[inter_r * GRID_SIZE + inter_c];

                    if (interCellNode && !selectedCells.includes(interCellNode) && !interCellNode.classList.contains('hint-found')) {
                       selectCell(interCellNode);
                    }
                }
            }
        }

        function selectionEnd() {
            if (!isSelectingForDesktop) return;
            isSelectingForDesktop = false;
            if (selectedCells.length > 0) {
                checkSelectedWord(false);
            }
        }
        
        function selectCell(cell) {
            selectedCells.push(cell);
            cell.classList.add('selected');
            updateWordPreview();
        }

        function clearSelection() {
            selectedCells.forEach(c => c.classList.remove('selected'));
            selectedCells = [];
            updateWordPreview();
        }

        function updateWordPreview() {
            currentWordPreview.textContent = selectedCells.map(c => c.textContent).join('');
        }

        function checkSelectedWord(isTap) {
            const selectedWord = currentWordPreview.textContent;
            if (wordsToFind.includes(selectedWord) && !foundWords.has(selectedWord)) {
                foundWords.add(selectedWord);
                document.getElementById('word-' + selectedWord).classList.add('found');
                updateScore(selectedWord.length * 10);
                setTimeout(clearSelection, 100);
            }
            if (!isTap) {
                clearSelection();
            }
        }
        
        function showSolutions() {
            isGameActive = false;
            megoldasBtn.disabled = true;
            megoldasBtn.style.display = 'none';
            renderRewards(); 
            wordsToFind.forEach(word => {
                if (!foundWords.has(word)) {
                    const positions = wordPositions.get(word);
                    if (positions) {
                        positions.forEach(pos => {
                            const cell = gridContainer.children[pos.r * GRID_SIZE + pos.c];
                            cell.style.transition = 'background-color 0.5s, box-shadow 0.5s';
                            cell.style.backgroundColor = 'var(--neon-purple)';
                            cell.style.boxShadow = '0 0 15px var(--neon-purple)';
                        });
                    }
                }
            });
        }
        
        function startNewRound() {
            isGameActive = true;
            megoldasBtn.style.display = 'none';
            timerDisplay.style.display = 'block';
            
            newBoardContainer.style.display = 'none';
            wordListElement.style.display = 'block';
            wordListTitle.style.display = 'block';
            
            const timeSeed = Math.floor(Date.now() / CYCLE_DURATION_MS);
            setupNewGame(timeSeed);
            scheduleNextBoard();
        }
        
        function createSeededRandom(seed) { let s = seed; return () => { s = (s * 9301 + 49297) % 233280; return s / 233280; }; }
        function seededShuffle(array, randomFunc) { let i = array.length; while (i) { let j = Math.floor(randomFunc() * i--);[array[i], array[j]] = [array[j], array[i]]; } return array; }
        
        function setupNewGame(seed) {
            megoldasBtn.disabled = false;
            wordsToFind = []; wordPositions.clear(); grid = []; selectedCells = []; foundWords.clear(); score = 0;
            gridContainer.innerHTML = ''; wordListElement.innerHTML = '';
            
            const seededRandom = createSeededRandom(seed);
            let tempGrid = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(''));
            let wordSelection = seededShuffle([...hungarianWords], seededRandom);
            
            let placedWordsCount = 0;
            while (placedWordsCount < WORD_COUNT && wordSelection.length > 0) {
                let word = wordSelection.pop().toUpperCase();
                if (word.length > GRID_SIZE || word.length < 3) continue;
                let placement = findPlacementForWord(word, tempGrid, seededRandom);
                if (placement) { wordsToFind.push(word); wordPositions.set(word, placement.cells); placement.cells.forEach((cell, i) => { tempGrid[cell.r][cell.c] = word[i]; }); placedWordsCount++; }
            }
            
            grid = tempGrid;
            fillGridWithRandomLetters(seededRandom);
            renderGrid(); renderWordList(); updateScore(0);
        }

        function findPlacementForWord(word, currentGrid, randomFunc) {
            let attempts = 0;
            while (attempts < 100) {
                let path = [{ r: Math.floor(randomFunc() * GRID_SIZE), c: Math.floor(randomFunc() * GRID_SIZE) }];
                for (let i = 1; i < word.length; i++) {
                    let lastPos = path[i - 1]; let neighbors = getNeighbors(lastPos.r, lastPos.c, path);
                    seededShuffle(neighbors, randomFunc);
                    if (neighbors.length === 0) break;
                    path.push(neighbors[0]);
                }
                if (path.length === word.length) {
                    let canPlace = true;
                    for (let i = 0; i < word.length; i++) { if (currentGrid[path[i].r][path[i].c] !== '' && currentGrid[path[i].r][path[i].c] !== word[i]) { canPlace = false; break; } }
                    if (canPlace) return { cells: path };
                }
                attempts++;
            }
            return null;
        }

        function getNeighbors(r, c, exclude) { let neighbors = []; for (let dr = -1; dr <= 1; dr++) { for (let dc = -1; dc <= 1; dc++) { if (dr === 0 && dc === 0) continue; let nr = r + dr, nc = c + dc; if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE && !exclude.some(p => p.r === nr && p.c === nc)) { neighbors.push({ r: nr, c: nc }); } } } return neighbors; }
        function fillGridWithRandomLetters(randomFunc) { const alphabet = 'AÁBCDEÉFGHIÍJKLMNOÓÖŐPQRSTUÚÜŰVWXYZ'; for (let i = 0; i < GRID_SIZE; i++) for (let j = 0; j < GRID_SIZE; j++) if (grid[i][j] === '') grid[i][j] = alphabet[Math.floor(randomFunc() * alphabet.length)]; }
        
        function renderGrid() {
            gridContainer.innerHTML = '';
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.textContent = grid[i][j];
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.style.backgroundColor = '';
                    cell.style.boxShadow = '';
                    cell.style.transition = '';

                    if (isMobile) {
                        cell.addEventListener('touchstart', (e) => { e.preventDefault(); selectionStart(cell); }, { passive: false });
                        cell.addEventListener('touchmove', (e) => { 
                            e.preventDefault();
                            const touch = e.touches[0];
                            const targetCell = document.elementFromPoint(touch.clientX, touch.clientY);
                            if(targetCell && targetCell.classList.contains('grid-cell')) {
                                selectionMove(targetCell);
                            }
                        }, { passive: false });
                        cell.addEventListener('touchend', (e) => { e.preventDefault(); selectionEnd(); });
                    } else {
                        cell.addEventListener('mousedown', () => selectionStart(cell));
                        cell.addEventListener('mouseover', () => selectionMove(cell));
                    }
                    gridContainer.appendChild(cell);
                }
            }
            if (!isMobile) {
                document.addEventListener('mouseup', selectionEnd);
            }
        }

        function renderWordList() { wordListElement.innerHTML = ''; const words = [...wordsToFind].sort((a,b) => a.localeCompare(b)); words.forEach(word => { const li = document.createElement('li'); li.textContent = word; li.id = 'word-' + word; if (foundWords.has(word)) li.classList.add('found'); wordListElement.appendChild(li); }); }

        const rewards = [ { id: 'vowel_hint', name: 'Magánhangzó Tipp', desc: 'Megjelöli egy szó magánhangzóit.', cost: 1000, action: vowelHint }, { id: 'point_bonus', name: 'Pont Bónusz', desc: '+200 pont.', cost: 1500, action: () => updateScore(200) }, { id: 'reveal_letter', name: 'Betű Felfedése', desc: 'Felvillant egy betűt egy szóból.', cost: 2000, action: revealLetter }, { id: 'first_letter', name: 'Első Betű', desc: 'Véglegesen megjelöli egy szó első betűjét.', cost: 4000, action: revealFirstLetter }, { id: 'glimpse_word', name: 'Szópillantás', desc: 'Felvillantja egy szó útvonalát.', cost: 7500, action: glimpseWord }, { id: 'free_pass', name: 'Ingyen Passz', desc: 'Megtalálja a legrövidebb hiányzó szót.', cost: 12000, action: findShortestWord }];
        function updateScore(points) { score = Math.max(0, score + points); scoreElement.textContent = score; renderRewards(); }
        function renderRewards() { rewardsListElement.innerHTML = ''; rewards.forEach(r => { const isAffordable = score >= r.cost; const el = document.createElement('div'); el.className = 'reward-item ' + (isAffordable && isGameActive ? 'affordable' : 'disabled'); el.innerHTML = `<div class="reward-name">${r.name}</div><div class="reward-desc">${r.desc}</div><div class="reward-cost">${r.cost} Pont</div>`; if (isAffordable && isGameActive) el.onclick = () => { if (score >= r.cost) { updateScore(-r.cost); r.action(); } }; rewardsListElement.appendChild(el); }); }
        function getUnfoundWord(shortest = false) { let unfound = wordsToFind.filter(w => !foundWords.has(w)); if (unfound.length === 0) return null; if (shortest) unfound.sort((a,b) => a.length - b.length); return unfound[0]; }
        function vowelHint() { const word = getUnfoundWord(); if (!word) return; const vowels = "AÁEÉIÍOÓÖŐUÚÜŰ"; document.getElementById('word-' + word).innerHTML = word.split('').map(l => vowels.includes(l) ? `<span style="color: var(--neon-amber);">${l}</span>` : l).join(''); }
        function revealLetter() { const word = getUnfoundWord(); if (!word) return; const pos = wordPositions.get(word); const cellInfo = pos[Math.floor(Math.random() * pos.length)]; const cell = gridContainer.children[cellInfo.r * GRID_SIZE + cellInfo.c]; cell.classList.add('solution-path'); setTimeout(() => cell.classList.remove('solution-path'), 1000); }
        function revealFirstLetter() { const word = getUnfoundWord(); if (!word) return; const cellInfo = wordPositions.get(word)[0]; gridContainer.children[cellInfo.r * GRID_SIZE + cellInfo.c].classList.add('hint-found'); }
        function glimpseWord() { const word = getUnfoundWord(); if (!word) return; const positions = wordPositions.get(word); positions.forEach(p => { const cell = gridContainer.children[p.r * GRID_SIZE + p.c]; cell.classList.add('solution-path'); setTimeout(() => cell.classList.remove('solution-path'), 1000); }); }
        function findShortestWord() { const wordToFind = getUnfoundWord(true); if (!wordToFind) return; foundWords.add(wordToFind); document.getElementById('word-' + wordToFind).classList.add('found'); updateScore(wordToFind.length * 10); }

        function endRound() {
            if (!isGameActive) return;
            isGameActive = false;
            clearInterval(gameTimer);

            timerDisplay.style.display = 'none';
            wordListElement.style.display = 'none';
            wordListTitle.style.display = 'none';
            newBoardContainer.style.display = 'flex';
            
            if(!megoldasBtn.disabled) {
                megoldasBtn.style.display = 'block';
            }
            renderRewards();
        }
        
        function scheduleNextBoard() {
            if (gameTimer) clearInterval(gameTimer);

            const checkTime = () => {
                if (!isGameActive) {
                    clearInterval(gameTimer);
                    return;
                }
                const now = new Date();
                const currentSeedStart = Math.floor(now.getTime() / CYCLE_DURATION_MS) * CYCLE_DURATION_MS;
                const nextBoardDate = new Date(currentSeedStart + CYCLE_DURATION_MS);

                const remainingMilliseconds = nextBoardDate - now;

                if (remainingMilliseconds <= 0) {
                    endRound();
                    return;
                }

                const targetTime = nextBoardDate.toLocaleTimeString('hu-HU', { hour: '2-digit', minute: '2-digit' });
                timerDisplay.textContent = `Új tábla ${targetTime}-kor!`;

                if (remainingMilliseconds <= 60000 && isGameActive && !megoldasBtn.disabled) {
                    megoldasBtn.style.display = 'block';
                }
            };

            checkTime();
            gameTimer = setInterval(checkTime, 1000);
        }
    </script>
</body>
</html>
